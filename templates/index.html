<!DOCTYPE html>
<html>
<head>
    <title>Is PG County Getting Safer?</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1 style="text-align:center;">Crime in PG County is Decreasing</h1>

    <h2>Month in Crime: By the Numbers"</h2>
    <canvas id="monthlyCrimeChart"></canvas>

    <h2>From Theft to Violent Crime: PGâ€™s Offense Breakdown"</h2>
    <canvas id="crimeTypeChart"></canvas>

    <h2>Which Sector Has the most time on there hands?</h2>
    <canvas id="sectorScatterChart"></canvas>

    <p>
    <strong>PGPD Sector Code Legend:</strong><br>
    Sectors A&B are in Hyatsville<br>
    Sectors D&E are in Bowie<br>
    Sector G is Landover<br>
    Sectors J&K are in Oxon Hill<br>
    Sector F is Clinton<br>
    Sector C is Beltsville<br>
    Sector W is Fort Washington<br>
    Sector H is Westphalia<br>
    Sector TRU is Unknown

<div style="margin-top: 30px; padding-top: 10px; border-top: 1px solid #ccc;">
    <h3>Summary</h3>
    <p>
        Crime in PG County is generally decreasing, though there are fluctuations.
        There are ups and downs month to month. However, the overall trend from mid-2023 
        to early 2025 appears to be slightly decreasing.
    </p>
</div>


    <!-- #comment Add summary or analysis text here under each chart -->

    <script>
        // Total Monthly Crime Line Chart
        fetch('/api/monthly_crime')
        .then(response => response.json())
        .then(data => {
            const labels = data.map(d => d.year_month);
            const counts = data.map(d => d.total_crimes);
            new Chart(document.getElementById('monthlyCrimeChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total Crimes',
                        data: counts,
                        fill: false,
                        borderWidth: 2
                    }]
                }
            });
        });

        // Crime Type Distribution Line Chart
        fetch('/api/crime_type_dist')
        .then(response => response.json())
        .then(data => {
            const grouped = {};
            data.forEach(d => {
                if (!grouped[d.clearance_code_inc_type]) grouped[d.clearance_code_inc_type] = {};
                grouped[d.clearance_code_inc_type][d.year_month] = d.count;
            });

            const months = [...new Set(data.map(d => d.year_month))].sort();
            const datasets = Object.keys(grouped).map((type, i) => {
                const data = months.map(m => grouped[type][m] || 0);
                return { label: type, data: data, fill: false, borderWidth: 1 };
            });

            new Chart(document.getElementById('crimeTypeChart'), {
                type: 'line',
                data: {
                    labels: months,
                    datasets: datasets
                }
            });
        });

        // Crimes by PGPD Sector and Year (Grouped Bar Chart with Sector Codes)
fetch('/api/sector_crime')
  .then(response => response.json())
  .then(data => {
    const years = [...new Set(data.map(d => d.year))].sort();
    const sectors = [...new Set(data.map(d => d.pgpd_sector))].sort();

    const datasets = sectors.map(sector => {
      return {
        label: sector,
        data: years.map(y => {
          const match = data.find(d => d.pgpd_sector === sector && d.year === y);
          return match ? match.crime_count : 0;
        }),
        borderWidth: 1
      };
    });

    new Chart(document.getElementById('sectorScatterChart'), {
      type: 'bar',
      data: {
        labels: years,
        datasets: datasets
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Crimes by PGPD Sector and Year'
          }
        },
        scales: {
          x: {
            title: {
              display: true,
              text: 'Year'
            }
          },
          y: {
            title: {
              display: true,
              text: 'Crime Count'
            }
          }
        }
      }
    });
  });


    </script>
</body>
</html>
